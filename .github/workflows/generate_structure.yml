name: Generate and Commit Project Structure

on:
  push:

jobs:
  update_project_structure:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    
    - name: Install Tree Command
      run: sudo apt-get install tree

    - name: Generate Project Structure
      run: |
        echo "Project Structure:" > Project_Structure.txt
        tree -I '.git|node_modules|.github|*.md' >> Project_Structure.txt

    - name: Check for Changes
      id: check_changes
      run: |
        git diff --exit-code Project_Structure.txt
        if [ $? -eq 1 ]
        then
          echo "::set-output name=changes::true"
        else
          echo "::set-output name=changes::false"
        fi

    - name: Commit and Push Changes
      if: steps.check_changes.outputs.changes == 'true'
      run: |
        git config --global user.name 'GitHub Actions'
        git config --global user.email 'actions@github.com'
        git add Project_Structure.txt
        git commit -m "Update Project Structure"
        git push
